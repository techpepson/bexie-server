// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                          String              @id @default(uuid())
  name                        String
  email                       String              @unique
  phone                       String
  password                    String
  role                        String
  status                      String
  isFirstTimeUser             Boolean             @default(true)
  emailVerificationToke       String?
  phoneNumberVerificationToke String?
  isEmailVerified             Boolean             @default(false)
  isPhoneNumberVerified       Boolean             @default(false)
  passwordResetToken          String?
  createdAt                   DateTime            @default(now())
  updatedAt                   DateTime            @default(now())
  reviews                     Reviews[]
  logs                        Logs[]
  consumers                   Consumer?
  vendors                     Vendor?
  userNotifications           UserNotification[]
  payments                    Payment?
  transferRecipient           TransferRecipients?
  wallet                      Wallet?
  rider                       Rider?
}

model Vendor {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id])
  userId    String   @unique
  shop      Shop?
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  shopId    String
}

model Consumer {
  id             String            @id @unique @default(uuid())
  user           User              @relation(fields: [userId], references: [id])
  userId         String            @unique
  watched        RecentlyWatched[]
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @default(now())
  cart           Cart[]
  orders         Order[]
  earnings       Earning?
  totalReferrals Int               @default(0)
  referralCode   String            @unique
}

model Product {
  id               String            @id @default(uuid())
  name             String
  description      String
  color            String
  images           String[]
  category         String
  discount         Discount?         @relation(fields: [discountId], references: [id])
  shop             Shop              @relation(fields: [shopId], references: [id])
  discountType     String?
  discountAmount   Float?
  quantity         Int
  status           String
  stockStatus      String
  price            Float
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @default(now())
  discountId       String?
  reviews          Reviews[]
  deliveryOption   DeliveryOption[]
  shopId           String
  recentlyWatcheds RecentlyWatched[]
  cartId           String?
  cart             Cart?             @relation(fields: [cartId], references: [id])
  orderId          String?
  orderItems       OrderItem[]
}

model Shop {
  id            String    @id @default(uuid())
  name          String
  description   String
  location      String
  contact       String
  deliveryRange Int
  logo          String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @default(now())
  vendor        Vendor    @relation(fields: [vendorId], references: [userId], onDelete: Cascade)
  products      Product[]
  vendorId      String    @unique
}

model DeliveryOption {
  id        String   @id @default(uuid())
  type      String
  fee       Float
  unit      String   @default("days")
  duration  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  orders    Order[]
  product   Product? @relation(fields: [productId], references: [id])
  productId String?
}

model Discount {
  id          String    @id @default(uuid())
  code        String?   @unique
  description String?
  type        String    @default("percentage")
  amount      Float     @default(0.0)
  validFrom   DateTime?
  validTo     DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now())
  products    Product[]
}

model Reviews {
  id        String   @id @default(uuid())
  userId    String
  productId String
  user      User     @relation(fields: [userId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])
  rating    Int
  comment   String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

model Logs {
  id          String   @id @default(uuid())
  title       String
  description String
  userId      String?
  user        User?    @relation(fields: [userId], references: [id])
  timestamp   DateTime @default(now())
}

model RecentlyWatched {
  id        String   @id @default(uuid())
  userId    String
  productId String
  consumer  Consumer @relation(fields: [userId], references: [id])
  product   Product  @relation(fields: [productId], references: [id])
  watchedAt DateTime @default(now())
}

model Cart {
  id         String    @id @default(uuid())
  consumerId String    @unique
  quantity   Int       @default(1)
  consumer   Consumer  @relation(fields: [consumerId], references: [userId])
  products   Product[]
  addedAt    DateTime  @default(now())
}

model Order {
  id               String          @id @default(uuid())
  userId           String
  address          String
  contact          String
  totalPrice       Float
  deliveryOption   DeliveryOption? @relation(fields: [deliveryOptionId], references: [id])
  deliveryOptionId String?
  paymentMethod    String
  paymentStatus    String
  referralCode     String?
  items            OrderItem[]
  status           String
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @default(now())
  consumer         Consumer        @relation(fields: [userId], references: [userId])
  productId        String?
  rider            Rider?          @relation(fields: [riderId], references: [id])
  riderId          String?
}

model OrderItem {
  id        String  @id @default(uuid())
  orderId   String
  productId String
  quantity  Int
  price     Float
  order     Order   @relation(fields: [orderId], references: [id])
  product   Product @relation(fields: [productId], references: [id])
}

model Rider {
  id            String    @id @default(uuid())
  orders        Order[]
  vehicleType   String
  vehicleNumber String
  user          User      @relation(fields: [userId], references: [id])
  userId        String    @unique
  earnings      Earning[]
}

model SystemNotification {
  id                String             @id @default(uuid())
  title             String
  message           String
  createdAt         DateTime           @default(now())
  userNotifications UserNotification[]
}

model UserNotification {
  id                   String             @id @default(uuid())
  userId               String
  systemNotificationId String
  isRead               Boolean            @default(false)
  createdAt            DateTime           @default(now())
  user                 User               @relation(fields: [userId], references: [id])
  systemNotification   SystemNotification @relation(fields: [systemNotificationId], references: [id])
}

model Admin {
  id         String       @id @default(uuid())
  name       String       @default("Admin")
  password   String       @default("admin123")
  email      String       @unique @default("admin@bexiemart.com")
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @default(now())
  systemLogs SystemLogs[]
}

model SystemLogs {
  id        String   @id @default(uuid())
  action    String
  details   String
  adminId   String
  admin     Admin    @relation(fields: [adminId], references: [id])
  timestamp DateTime @default(now())
}

model Payment {
  id            String   @id @default(uuid())
  initReference String   @unique
  status        String   @default("pending")
  accessCode    String?
  amount        Float
  currency      String   @default("GHS")
  paymentMethod String
  orderId       String?  @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id])
}

model TransferRecipients {
  id            String   @id @default(uuid())
  type          String?
  currency      String   @default("GHS")
  name          String?
  accountNumber String?
  accountName   String?
  bankCode      String?
  bankName      String
  recipientCode String
  activeStatus  Boolean  @default(false)
  recipientId   Int?
  user          User     @relation(fields: [userId], references: [id])
  userId        String   @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now())
}

model Wallet {
  id        String   @id @default(uuid())
  balance   Float    @default(0.0)
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

model Earning {
  id                String    @id @default(uuid())
  totalAmount       Float     @default(0.0)
  pendingCommission Float     @default(0.0)
  totalWithdrawn    Float     @default(0.0)
  rider             Rider?    @relation(fields: [riderId], references: [id])
  riderId           String?
  consumerId        String?   @unique
  consumer          Consumer? @relation(fields: [consumerId], references: [id])
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @default(now())
}
