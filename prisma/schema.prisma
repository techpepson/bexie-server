generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                            String              @id @default(uuid())
  name                          String
  email                         String              @unique
  phone                         String
  password                      String
  role                          String
  status                        String
  isFirstTimeUser               Boolean             @default(true)
  preferOrderNotifications      Boolean             @default(true)
  preferPromotionalEmails       Boolean             @default(true)
  preferNewProductNotifications Boolean             @default(true)
  emailVerificationToke         String?
  address                       String?
  region                        String              @default("accra")
  phoneNumberVerificationToke   String?
  isEmailVerified               Boolean             @default(false)
  isPhoneNumberVerified         Boolean             @default(false)
  passwordResetToken            String?
  createdAt                     DateTime            @default(now())
  updatedAt                     DateTime            @default(now())
  reviews                       Reviews[]
  logs                          Logs[]
  consumers                     Consumer?
  vendors                       Vendor?
  userNotifications             UserNotification[]
  payments                      Payment?
  transferRecipient             TransferRecipients?
  wallet                        Wallet?
  rider                         Rider?
  card                          Card?
  mobileMoney                   MobileMoney?
  paymentMethod                 PaymentMethod?
}

model Vendor {
  id        String   @id @default(uuid())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String   @unique
  status    String   @default("pending")
  shop      Shop?
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  shopId    String
  coupons   Coupon[]
}

model Consumer {
  id             String            @id @unique @default(uuid())
  user           User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId         String            @unique
  watched        RecentlyWatched[]
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @default(now())
  cart           Cart[]
  orders         Order[]
  earnings       Earning?
  totalReferrals Int               @default(0)
  referralCode   String            @unique
  wishlists      Wishlist[]
}

model Product {
  id          String   @id @default(uuid())
  name        String
  description String
  color       String
  images      String[]

  shop             Shop              @relation(fields: [shopId], references: [id], onDelete: Cascade)
  discountType     String?
  discountAmount   Float?
  quantity         Int
  status           String
  stockStatus      String
  price            Float
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @default(now())
  discountId       String?
  deliveryOption   DeliveryOption[]
  shopId           String
  recentlyWatcheds RecentlyWatched[]
  cartId           String?
  cart             Cart?             @relation(fields: [cartId], references: [id], onDelete: Cascade)
  orderId          String?
  orderItems       OrderItem[]
  wishlists        Wishlist[]
}

model Shop {
  id            String    @id @default(uuid())
  name          String
  description   String
  location      String
  contact       String
  deliveryRange Int
  logo          String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @default(now())
  vendor        Vendor    @relation(fields: [vendorId], references: [userId], onDelete: Cascade)
  products      Product[]
  vendorId      String    @unique
}

model DeliveryOption {
  id        String   @id @default(uuid())
  type      String
  fee       Float
  unit      String   @default("days")
  duration  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
  orders    Order[]
  product   Product? @relation(fields: [productId], references: [id], onDelete: Cascade)
  productId String?
}

model Coupon {
  id                String   @id @default(uuid())
  title             String
  code              String   @unique
  discountType      String // "percentage" or "fixed_amount"
  discountAmount    Float
  validUntil        DateTime
  usageLimit        Int
  currentUsage      Int      @default(0)
  description       String?
  firstPurchaseOnly Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @default(now())
  vendorId          String?
  vendor            Vendor?  @relation(fields: [vendorId], references: [userId], onDelete: Cascade)
}

model Reviews {
  id        String   @id @default(uuid())
  userId    String
  orderId   String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  order     Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  rating    Int
  comment   String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

model Logs {
  id          String   @id @default(uuid())
  title       String
  description String
  userId      String?
  user        User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  timestamp   DateTime @default(now())
}

model RecentlyWatched {
  id        String   @id @default(uuid())
  userId    String
  productId String
  consumer  Consumer @relation(fields: [userId], references: [id], onDelete: Cascade)
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  watchedAt DateTime @default(now())

  @@unique([productId, userId])
}

model Cart {
  id         String    @id @default(uuid())
  consumerId String    @unique
  quantity   Int       @default(1)
  consumer   Consumer  @relation(fields: [consumerId], references: [userId], onDelete: Cascade)
  products   Product[]
  addedAt    DateTime  @default(now())
}

model Wishlist {
  id         String   @id @default(uuid())
  consumerId String
  productId  String
  consumer   Consumer @relation(fields: [consumerId], references: [userId], onDelete: Cascade)
  product    Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  addedAt    DateTime @default(now())

  @@unique([consumerId, productId])
}

model Order {
  id               String          @id @default(uuid())
  userId           String
  address          String
  contact          String
  totalPrice       Float
  deliveryOption   DeliveryOption? @relation(fields: [deliveryOptionId], references: [id], onDelete: SetNull)
  deliveryOptionId String?
  paymentMethod    String
  paymentStatus    String //this is payment to vendors
  referralCode     String?
  items            OrderItem[]
  status           String
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @default(now())
  consumer         Consumer        @relation(fields: [userId], references: [userId], onDelete: Cascade)
  productId        String?
  rider            Rider?          @relation(fields: [riderId], references: [id], onDelete: SetNull)
  riderId          String?
  reviews          Reviews[]
}

model OrderItem {
  id        String  @id @default(uuid())
  orderId   String
  productId String
  quantity  Int
  price     Float
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

model Rider {
  id            String    @id @default(uuid())
  orders        Order[]
  vehicleType   String
  status        String    @default("pending")
  vehicleNumber String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId        String    @unique
  earnings      Earning[]
}

model SystemNotification {
  id                String             @id @default(uuid())
  title             String
  message           String
  createdAt         DateTime           @default(now())
  userNotifications UserNotification[]
}

model UserNotification {
  id                   String             @id @default(uuid())
  userId               String             @unique
  systemNotificationId String
  isRead               Boolean            @default(false)
  createdAt            DateTime           @default(now())
  user                 User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  systemNotification   SystemNotification @relation(fields: [systemNotificationId], references: [id], onDelete: Cascade)
}

model Admin {
  id         String       @id @default(uuid())
  name       String       @default("Admin")
  password   String       @default("admin123")
  role       String       @default("system_admin")
  email      String       @unique @default("admin@bexiemart.com")
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @default(now())
  systemLogs SystemLogs[]
}

model SystemLogs {
  id        String   @id @default(uuid())
  action    String
  details   String
  adminId   String
  admin     Admin    @relation(fields: [adminId], references: [id], onDelete: Cascade)
  timestamp DateTime @default(now())
}

model Payment {
  id            String   @id @default(uuid())
  initReference String   @unique
  status        String   @default("pending")
  accessCode    String?
  amount        Float
  currency      String   @default("GHS")
  paymentMethod String
  orderId       String?  @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model TransferRecipients {
  id            String   @id @default(uuid())
  type          String?
  currency      String   @default("GHS")
  name          String?
  accountNumber String?
  accountName   String?
  bankCode      String?
  bankName      String
  recipientCode String
  activeStatus  Boolean  @default(false)
  recipientId   Int?
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId        String   @unique
  createdAt     DateTime @default(now())
  updatedAt     DateTime @default(now())
}

model Wallet {
  id        String   @id @default(uuid())
  balance   Float    @default(0.0)
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now())
}

model Earning {
  id                String    @id @default(uuid())
  totalAmount       Float     @default(0.0)
  pendingCommission Float     @default(0.0)
  totalWithdrawn    Float     @default(0.0)
  rider             Rider?    @relation(fields: [riderId], references: [id], onDelete: Cascade)
  riderId           String?
  consumerId        String?   @unique
  consumer          Consumer? @relation(fields: [consumerId], references: [id], onDelete: Cascade)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @default(now())
}

model Card {
  id             String          @id @default(uuid())
  cardNumber     String
  expiryDate     DateTime
  cvv            String
  userId         String          @unique
  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @default(now())
  paymentMethods PaymentMethod[]
}

model MobileMoney {
  id             String          @id @default(uuid())
  provider       String
  phoneNumber    String
  bankCode       String
  userId         String          @unique
  user           User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @default(now())
  paymentMethods PaymentMethod[]
}

model PaymentMethod {
  id            String       @id @default(uuid())
  cardId        String?
  mobileMoneyId String?
  card          Card?        @relation(fields: [cardId], references: [id], onDelete: Cascade)
  mobileMoney   MobileMoney? @relation(fields: [mobileMoneyId], references: [id], onDelete: Cascade)
  user          User?        @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId        String       @unique
}
